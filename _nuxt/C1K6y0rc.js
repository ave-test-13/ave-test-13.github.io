import{R as t,v as o,r as a,fe as e,bR as n,bM as s,ff as u,a0 as l,fg as i,cv as r,fh as m,fi as c,fj as d,fk as h,fl as p,fm as f,fn as v,fo as _,fp as y,fq as k,fr as w,fs as T}from"./BYaUYrp3.js";import{a as b,b as g}from"./X1xoQqTK.js";function x(){const x=t(),{t:S}=o(),A=a(!1);async function F(t,o){try{A.value=!0;await t.swapCallStatic();const a=t.swapInfo,e=(a.fromToken.isWrapper&&a.toToken.isETH||a.toToken.isWrapper&&a.fromToken.isETH,{from_address:a.fromToken.address,from_symbol:a.fromToken.symbol,from_amount:Number(v(a.fromTokenAmount||0,a.fromToken.decimals)),to_address:a.toToken.address,to_symbol:a.toToken.symbol,to_amount:Number(v(a.toTokenAmount||0,a.toToken.decimals)),chain:o,transaction:"",wallet_address:x.address});let s=null;t.swap().then((t=>(s=setTimeout((()=>{n({type:"success",message:S("transactionsSubmitted")})}),500),b({chain:o,destination:"wallet rpc",type:10,tx_hash:t.hash,status:1,wallet:x.address,out_token:e.to_address,out_amount:Number(v(a.toTokenAmount||0,a.toToken.decimals)),in_token:e.from_address,in_amount:Number(v(a.fromTokenAmount||0,a.fromToken.decimals))}),A.value=!1,t.wait()))).then((t=>{var a,e;return s&&(clearTimeout(s),s=null),n({type:"success",message:S("tradeSuccess")}),g({chain:o,tx_hash:t.hash,status:100,to:(null==(e=null==(a=null==t?void 0:t.to)?void 0:a.toLowerCase)?void 0:e.call(a))||""}),t})).catch((t=>{A.value=!1,c(t,"swap")}))}catch(a){A.value=!1,c(a,"swap")}}function M(t){return T({tokenAddress:"solana"===t?"So11111111111111111111111111111111111111112":r,chain:t})}return{walletSwap:async function(t,o){var a,T,N;if(!(null==(T=null==(a=Object.keys(e).concat(["solana","sui","ton"]))?void 0:a.includes)?void 0:T.call(a,o.chain)))return void n({title:"Error",type:"error",message:S("noSupportChain",{chain:s(o.chain).name})});if(o.chain!==x.chain)return void n({title:"Error",type:"error",message:S("chainNotSame1")});A.value=!0;let O=await M(o.chain).catch((()=>({balance:"0"})));if((null==O?void 0:O.balance)<t||0===Number(null==O?void 0:O.balance))return n({title:"Error",type:"error",message:S("insufficientBalance")}),void(A.value=!1);const E=o.chain,D=o.token,R=o.amm,B=null==R?void 0:R.includes("fourmeme");if(Number(t)>0){const a=s(E).decimals;if("solana"===E)return void async function(t,o){var a;const e=t.chain;if("solana"===e){A.value=!0;const e=await p(t.token);let s=!1;const i=!1,r=9,m=null==e?void 0:e.token_decimals,d={inputMint:"So11111111111111111111111111111111111111112",inputDecimals:r,inputMintSymbol:"SOL",inputMintName:"SOL",inputAmount:o||0,outputMint:t.token,outputDecimals:m,outputMintSymbol:e.token_symbol,outputMintName:e.token_symbol,amount:u((null==(a=new l(o||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${r}})?`)))?void 0:a[0])||0,r).toFixed(0),slippageBps:new l(30).times(100).toFixed(0),swapMode:"ExactIn",slippage:30,isPump:s,isMoonshot:i};A.value=!0;let h={};f(d).then((t=>{var o,a,e;let s="0";return t.routeInfo&&t.transaction?(h=t,s=(null==(e=null==(a=null==(o=t.routeInfo)?void 0:o.amountOut)?void 0:a.amount)?void 0:e.toFixed())||"0"):t.outAmount?(h=t,s=v(t.outAmount||"0",m)):c("can not get quote"),async function(t,o){try{A.value=!0;const a={from_address:o.inputMint,from_symbol:o.inputDecimals,from_amount:o.inputAmount,to_address:o.outputMint,to_symbol:o.outputDecimals,to_amount:o.toAmount,chain:"solana",transaction:"",wallet_address:x.address};let e=null;y(t).then((t=>(A.value=!1,e=setTimeout((()=>{n({type:"success",message:S("transactionsSubmitted")})}),500),b({chain:"solana",destination:"true"===localStorage.solanaProtection?"v1/blxrsol/sendSolTx":"/ave_nodes/rpc/solana/sendFastSwapTx",type:10,tx_hash:t.hash,status:1,wallet:x.address,out_token:a.to_address,out_amount:o.toAmount,in_token:a.from_address,in_amount:o.fromAmount}),t.wait()))).then((t=>{var o;return e&&(clearTimeout(e),e=null),n({type:"success",message:S("tradeSuccess")}),t&&g({chain:"solana",tx_hash:null==(o=null==t?void 0:t.transaction)?void 0:o.signatures[0],status:100}),t})).catch((t=>{"Timeout"===(t||(null==t?void 0:t.message))?n({type:"error",message:S("timeout_error")}):"Swap fail"===(t||(null==t?void 0:t.message))?n({type:"error",message:S("swapFail")}):c(t,"solana"),A.value=!1}))}catch(a){A.value=!1,c(a,"solana")}}(h,{...d,toAmount:s}),t})).catch((t=>(A.value=!1,c((null==t?void 0:t.error)||t),Promise.resolve(""))))}}(o,t);if("ton"===E)return void async function(t,o){var a;const e=t.chain,s=t.token;if("ton"===e){const e=9,i=(await M(s)).decimals||9,m=new l(o||0).times("0.997"),d={inputToken:"TON",outputToken:s,inputTokenAmount:u((null==(a=m.toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${e}})?`)))?void 0:a[0])||0,e).toFixed(0),slippageBps:new l(30).times(100).toFixed(0)};A.value=!0;let h={};_(d).then((a=>{let s="0";return a.amountOut&&a.payload?(h=a,s=v(a.amountOut||"0",i),async function(t,o){try{A.value=!0;const a={from_address:r,from_symbol:"TON",from_amount:null==o?void 0:o.fromAmount,from_decimals:null==o?void 0:o.fromDecimals,to_address:o.outputToken,to_symbol:o.toSymbol,to_amount:null==o?void 0:o.toAmount,to_decimals:null==o?void 0:o.toDecimals,chain:"ton",transaction:"",wallet_address:x.address},e=[{address:null==t?void 0:t.to,amount:null==t?void 0:t.totalTransferAmount,payload:null==t?void 0:t.payload}],s=await k(a);s&&e.push(s);let u=null;w(e).then((t=>(u=setTimeout((()=>{n({type:"success",message:S("transactionsSubmitted")})}),500),b({chain:"ton",destination:"wallet rpc",type:10,tx_hash:t.hash,status:1,wallet:x.address,out_token:a.to_address,out_amount:o.toAmount,in_token:a.from_address,in_amount:o.fromAmount}),A.value=!1,t.wait()))).then((async t=>(u&&(clearTimeout(u),u=null),t&&(g({chain:"ton",tx_hash:null==t?void 0:t.hash,status:100}),n({type:"success",message:S("tradeSuccess")})),t))).catch((t=>{"Timeout"===(t||(null==t?void 0:t.message))?n({type:"error",message:S("timeout_error")}):"Swap fail"===(t||(null==t?void 0:t.message))?n({type:"error",message:S("tradeFail")}):c(t),A.value=!1}))}catch(a){A.value=!1,c(a)}}(h,{...d,fromAmount:o,toAmount:s,fromDecimals:e,toDecimals:i,toSymbol:t.symbol})):c("can not get quote"),a})).catch((t=>(c((null==t?void 0:t.error)||t),Promise.resolve(""))))}}(o,t);A.value=!0;const e={from_token:r,to_token:D,amountIn:u((null==(N=new l(t||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${a}})?`)))?void 0:N[0])||0,a).toFixed(0),amountOut:"0"};if(B){try{const a=await i(e,E);m({fromAmount:u(t,18).toFixed(0),fromToken:{address:r,decimals:18,symbol:"BNB",amount:u(t,18).toFixed(0)},toToken:{address:o.token,decimals:18,symbol:"",amount:(null==a?void 0:a.amountOut)||"0"},isAmountOut:!1,quoteResult:{...a}},10).then((async t=>{F({...t,isFourMeme:!0},o.chain)})).catch((t=>{c(t)})),A.value=!1}catch(I){A.value=!1,c(I)}return}d(e,"",E).then((t=>{const o=t[0];h(o,30).then((async t=>{F(t,E)})).catch((t=>{c(t)}))})).catch((t=>{c(t)}))}},loadingWalletSwap:A}}export{x as u};
