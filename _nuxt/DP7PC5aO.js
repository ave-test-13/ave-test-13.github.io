import{f as e,v as l,Q as a,I as o,x as t,R as s,bO as n,bP as i,ak as u,c as r,o as d,F as c,b as v,K as m,B as p,H as b,a4 as g,G as y,i as f,w,bQ as x,ao as h,ap as k,d as S,C as B,t as F,bM as T,E as _,s as V,a as A,aE as q,J as N,ad as C,a0 as I,bR as E,bS as L,bT as $,bU as R,bV as G,bW as M,bX as P,m as U,bY as W}from"./Cj-zygGq.js";import{u as j}from"./DpG_lJT5.js";import{r as O,u as Q}from"./D9tl18aR.js";const z={key:1,class:"ml-5px"},D={class:"text-20px"},H={class:"min-h-60px py-10px"},J={class:"text-16px"},K={class:"flex mt-10px"},X=e({__name:"quickSwapButton",props:{quickBuyValue:{},row:{},appendTo:{default:"#__nuxt"},buttonBg:{default:"rgba(18, 184, 134, 0.15)"},mainNameVisible:{type:Boolean},classNames:{default:""},styles:{default:""}},emits:["submitSwap"],setup(e,{emit:X}){const{t:Y}=l(),Z=e,ee=a(),le=o(!1),ae=o(!1),oe=o(""),te=t("noReminderQuickBuy",!1),{walletSwap:se,loadingWalletSwap:ne}=j(),ie=s(),ue=X;function re(e){var l;if(e.stopPropagation(),ue("submitSwap"),!C())return;if(le.value)return;if(new I(Z.quickBuyValue||0).lte(0))return void E({title:"Error",type:"error",message:Y("amountMustG0")});const{row:a}=Z;oe.value=Y("quickBuyMsg",{a:Z.quickBuyValue,m:(null==(l=T(Z.row.chain))?void 0:l.main_name)||"",s:a.symbol||(a.target_token==a.token0_address?a.token0_symbol:a.token1_symbol)}),te.value?ve():ae.value=!0}const de=o(),ce=n();async function ve(){var e;if(ae.value=!1,ie.provider&&ie.address&&!ee.evmAddress)return void async function(){const e=new I(Z.quickBuyValue||0).toFixed();se(e,Z.row)}();const{chain:l}=Z.row;le.value=!0,await async function(e){var l;const a=ee.getWalletAddress(e);if(!a)return;const o=await W({chain:e,tokens:[R(e)],walletAddress:a}),t=(null==o?void 0:o[0])||{};de.value={...t,symbol:null==(l=T(e))?void 0:l.main_name,chain:e,address:t.token||t.address,decimals:t.decimals||t.decimal}}(l);const a=de.value,o=null==(e=new I(Z.quickBuyValue||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${(null==a?void 0:a.decimals)||18}})?`)))?void 0:e[0];return(Number(o)||0)<=0?(E({title:"Error",type:"error",message:Y("amountTooSmall")}),void(le.value=!1)):new I(o||0).gt((null==a?void 0:a.balance)||0)?(E({title:"Error",type:"error",message:Y("insufficientBalance")}),void(le.value=!1)):void async function(e){var l,a,o,t,s;const{chain:n}=Z.row,i="solana"===n,{botSettings:u}=ce,r=null==(a=null==(l=null==u?void 0:u[n])?void 0:l.buy)?void 0:a.selected,d=null==(t=null==(o=null==u?void 0:u[n])?void 0:o.buy)?void 0:t[r];if(i&&(null==d?void 0:d.mev)&&!(await ee.getBundleAvailable()))return void(le.value=!1);const{gasTip1List:c,gasTip2List:v}=L($().gasTip,"solana"),m=(null==d?void 0:d.mev)?c:v,p=(null==d?void 0:d.mev)?null==d?void 0:d.gas[0]:null==(s=null==d?void 0:d.gas)?void 0:s[1];let b={};if(i){let e=(null==p?void 0:p.customFee)||(null==m?void 0:m[null==p?void 0:p.level])||"0.002";(null==d?void 0:d.mev)&&new I(e).lt("0.002")&&(e="0.002"),b.priorityFee=new I(e).times(10**9).toFixed(0)}else{const e=0===Number(null==p?void 0:p.customFee)?"0":(null==p?void 0:p.customFee)||(null==m?void 0:m[null==p?void 0:p.level])||"3";b.gasTip=Number(new I(e).times(10**9).toFixed(0)),b.contractType=0,b.chain=n}const g=R(n),y=(null==d?void 0:d.slippage)||"9",f=ee.getWalletAddress(n);if(!f)return;b={...b,batchId:Date.now().toString(),swapList:[{creatorAddress:f,inAmount:new I(e||0).times(10**de.value.decimals||0).toFixed(0)}],inTokenAddress:g,outTokenAddress:Z.row.token||Z.row.target_token,swapType:1,isPrivate:(null==d?void 0:d.mev)||!1,slippage:"auto"!==y?Number(new I(y).times(100).toFixed(0)):900,autoSell:ce.autoSellConfig_autoSell||!1,autoSellConfig:null==ce?void 0:ce.autoSellConfig,autoGas:(null==p?void 0:p.customFee)?0:((null==p?void 0:p.level)||0)+1,autoSellGas:(null==p?void 0:p.customFee)?0:((null==p?void 0:p.level)||0)+1,autoSellPriorityFee:i?b.priorityFee:b.gasTip};(i?G(b):M(b)).then((e=>function(e,l){var a;if(e){let o=setTimeout((()=>{E({type:"success",message:Y("transactionsSubmitted")}),me.placeOrderUpdate++,le.value=!1}),500);const t=(null==(a=null==Z?void 0:Z.row)?void 0:a.chain)||"",s=(null==e?void 0:e[0])||{};O({txInfo:s,chain:t,destination:"solana"===t?"/botapi/swap/createSolTx":"/botapi/swap/createSwapEvmTx",type:10});const n={[null==s?void 0:s.batchId]:null==s?void 0:s.id},i=U((()=>pe.wsResult.tgbot),(e=>{var a,t,s,u,r;const d=e.batchId;if(d===l){if(o&&(clearTimeout(o),o=null),me.placeOrderSuccess++,null==(t=null==(a=null==e?void 0:e.txList)?void 0:a[0])?void 0:t.success){E({type:"success",message:Y("tradeSuccess")});const l=null==(s=null==e?void 0:e.txList)?void 0:s[0];Q({...l,chain:null==e?void 0:e.chain},(null==n?void 0:n[d])||"")}else P((null==(r=null==(u=null==e?void 0:e.txList)?void 0:u[0])?void 0:r.failMessage)||"swap error");i(),le.value=!1}}))}}(e,b.batchId))).catch((e=>{P(e||"swap error"),le.value=!1}))}(o)}const me=i(),pe=u();return(e,l)=>{const a=B,o=b,t=q,s=_;return d(),r(c,null,[v(o,{disabled:!Number(e.quickBuyValue),loading:f(le)||f(ne),color:e.buttonBg,class:y(["flex items-center [&&]:px-12px",e.classNames]),style:g([{"--el-button-hover-bg-color":"#12B886","--el-button-hover-text-color":"#FFF","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},e.styles]),onClick:re},{default:w((()=>[x(e.$slots,"default",h(k({loading:f(le)||f(ne)})),(()=>{var l;return[f(le)||f(ne)?p("",!0):(d(),m(a,{key:0,class:"mr-4px",name:"mynaui:lightning-solid"})),S(" "+F(e.quickBuyValue||0)+" ",1),e.mainNameVisible?(d(),r("span",z,F((null==(l=("getChainInfo"in e?e.getChainInfo:f(T))(e.row.chain))?void 0:l.main_name)||""),1)):p("",!0)]}))])),_:3},8,["disabled","loading","color","class","style"]),f(ae)?(d(),m(s,{key:0,modelValue:f(ae),"onUpdate:modelValue":l[1]||(l[1]=e=>V(ae)?ae.value=e:null),title:e.$t("buy"),width:"400px","append-to":e.appendTo},{header:w((()=>[A("span",D,F(e.$t("buy")),1)])),footer:w((()=>[v(o,{type:"primary",class:"w-full",size:"large",onClick:N(ve,["stop"])},{default:w((()=>[S(F(e.$t("confirm1")),1)])),_:1})])),default:w((()=>[A("div",H,[A("div",J,F(f(oe)),1),A("div",K,[v(t,{modelValue:f(te),"onUpdate:modelValue":l[0]||(l[0]=e=>V(te)?te.value=e:null),class:"[&&]:[--el-checkbox-text-color:--d-999-l-666]",label:e.$t("noAlert"),size:"large"},null,8,["modelValue","label"])])])])),_:1},8,["modelValue","title","append-to"])):p("",!0)],64)}}});export{X as _};
